### Docker Storage Driver and Filesystem

When we install Docker on a system, it creates `/var/lib/docker`. This is where Docker stores all its data by default. Data means files related to images and containers running on Docker host.

`/var/lib/docker/containers` =  All files related to containers

`/var/lib/docker/image` = All files related to images

`/var/lib/docker/volumes` = Container volumes are stored here


### Layered Architecture

Q: How exactly does Docker store the files of an image and a container ? 

Dockerfile creats new layer in Docker image with the changes of previous layer.

 6. Container layer  

| Docker Image Layer | 
| ------------- | 
| 5. Entrypoint | 
| 4. Application source code | 
| 3. Dependencies | 
| 2. Packages  |
| 1. Base operating system layer  |

Image layer এর উপরে depend করে new writeable layer `container layer` up হবে  

Image layer is Read-only, মানে কোন কিছু edit করা যাবে না 

Container layer is Read-Writeable

The writeable layer is used to store data created by the container, such as log files written by the applications, any temporary files generated by the container or just any file modified by the user on that container. 

একটা image layer may be shared between multiple containers created from this image

### Volumes

Persist data

2 types of mounting available

1. Volume mounting
2. Bind mounting

_1st step: Create a volume first_
```shell
docker volume create data_volume
```
The created data_volume directory is: **`/var/lib/docker/volumes/data_volume`**. এইটাই default docker volume location.



_2nd step: Run container with that volume_
```shell
docker run -v data_volume:/var/lib/mysql mysql
```

> যদি আগে থেকে docker `data_volume` create না করে থাকি, তবে docker নিজেই সেই volume create করে নিবে and container এর সাথে mount করে নিবে 

Default location ছাড়া অন্য কোথাও volume mount করতে চাইলে **`-v`** এর পরে full path দিতে হবে। এইটাকে বলে **`bind mounting to container`**

```shell
docker run -v /data/mysql:/var/lib/mysql mysql
```

Even if the container is destroyed, the data is still active


Q: Who is responsible for doing all of these operations ? maitaining layered architecture, creating writeable layer, moving files across layes, enable copy wite etc...

Ans: **Storage Drivers**

Docker uses storage drivers to **enable layered architecture**

**Common Storage Drivers**

1. AUFS
2. ZFS
3. BTRFS
4. Device Mapper
5. Overlay
6. Overlay 2

Storage driver কোনটা হবে, এইটা depend করে undelying OS এর উপর। ubuntu use করে AUFS। Device Mapper মোটামুটি better option
